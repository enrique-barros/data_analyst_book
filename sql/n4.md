# Ejercicios SQL - Funciones de Agregado

Este conjunto de ejercicios está diseñado para practicar funciones de agregado usando las tablas `payments` y `products`. Todos los ejercicios se pueden resolver con los conocimientos adquiridos en la unidad.

---

## Estructura de las tablas

### Tabla `payments`

| Columna | Descripción |
|---------|-------------|
| `customerNumber` | Identificador del cliente |
| `checkNumber` | Número de cheque |
| `paymentDate` | Fecha del pago |
| `amount` | Monto del pago |

### Tabla `products`

| Columna | Descripción |
|---------|-------------|
| `productCode` | Código del producto |
| `productName` | Nombre del producto |
| `quantityInStock` | Cantidad en stock |
| `buyPrice` | Precio de compra |
| `MSRP` | Precio de venta sugerido |

---

## Ejercicio 1: Contar todos los registros

**Enunciado:**
Escribe una consulta que cuente cuántos pagos hay en la tabla `payments`.

<details>
<summary><b>Ver solución</b></summary>

**Solución:**
```sql
SELECT COUNT(*) FROM payments;
```

**Explicación:**
La función `COUNT(*)` cuenta el número total de filas en una tabla. El asterisco `*` significa "todas las filas". El resultado será un número que representa la cantidad total de pagos.

</details>

---

## Ejercicio 2: Contar registros con alias

**Enunciado:**
Escribe una consulta que cuente los pagos en la tabla `payments` y muestre el resultado con el alias "Total Pagos".

<details>
<summary><b>Ver solución</b></summary>

**Solución:**
```sql
SELECT COUNT(*) AS "Total Pagos" FROM payments;
```

**Explicación:**
Podemos usar un alias en una función de agregado para hacer el resultado más legible. El `COUNT(*)` devolverá un número que se mostrará con el encabezado "Total Pagos".

</details>

---

## Ejercicio 3: Sumar todos los pagos

**Enunciado:**
Escribe una consulta que calcule el monto total de todos los pagos en la tabla `payments`.

<details>
<summary><b>Ver solución</b></summary>

**Solución:**
```sql
SELECT SUM(amount) FROM payments;
```

**Explicación:**
La función `SUM()` suma todos los valores de una columna numérica. En este caso, suma todos los montos de pago, dándonos el total de dinero recibido en pagos.

</details>

---

## Ejercicio 4: Sumar con alias

**Enunciado:**
Escribe una consulta que calcule el monto total de todos los pagos y muestre el resultado con el alias "Total de Ingresos".

<details>
<summary><b>Ver solución</b></summary>

**Solución:**
```sql
SELECT SUM(amount) AS "Total de Ingresos" FROM payments;
```

**Explicación:**
Podemos usar un alias con `SUM()` para hacer el resultado más descriptivo. El resultado mostrará el encabezado "Total de Ingresos" seguido del valor total sumado.

</details>

---

## Ejercicio 5: Obtener el pago máximo

**Enunciado:**
Escribe una consulta que encuentre el monto más alto de un pago individual en la tabla `payments`.

<details>
<summary><b>Ver solución</b></summary>

**Solución:**
```sql
SELECT MAX(amount) FROM payments;
```

**Explicación:**
La función `MAX()` devuelve el valor máximo de una columna. En este caso, encontramos el pago más grande que se ha realizado. Esto es útil para identificar clientes importantes o pagos excepcionales.

</details>

---

## Ejercicio 6: Obtener el pago mínimo

**Enunciado:**
Escribe una consulta que encuentre el monto más bajo de un pago en la tabla `payments`.

<details>
<summary><b>Ver solución</b></summary>

**Solución:**
```sql
SELECT MIN(amount) FROM payments;
```

**Explicación:**
La función `MIN()` devuelve el valor mínimo de una columna. En este caso, encontramos el pago más pequeño. Es útil para identificar patrones de pagos pequeños.

</details>

---

## Ejercicio 7: MAX y MIN juntos

**Enunciado:**
Escribe una consulta que muestre simultáneamente el pago máximo y el pago mínimo de la tabla `payments` con los alias "Pago Máximo" y "Pago Mínimo".

<details>
<summary><b>Ver solución</b></summary>

**Solución:**
```sql
SELECT MAX(amount) AS "Pago Máximo", MIN(amount) AS "Pago Mínimo" FROM payments;
```

**Explicación:**
Podemos usar múltiples funciones de agregado en la misma consulta. Aquí mostramos tanto el máximo como el mínimo en una sola fila de resultados, con alias descriptivos.

</details>

---

## Ejercicio 8: Calcular el promedio de pagos

**Enunciado:**
Escribe una consulta que calcule el monto promedio de los pagos en la tabla `payments`.

<details>
<summary><b>Ver solución</b></summary>

**Solución:**
```sql
SELECT AVG(amount) FROM payments;
```

**Explicación:**
La función `AVG()` calcula el promedio (media aritmética) de los valores en una columna numérica. El resultado mostrará el monto promedio de los pagos realizados.

</details>

---

## Ejercicio 9: Promedio con alias

**Enunciado:**
Escribe una consulta que calcule el monto promedio de los pagos y muestre el resultado con el alias "Pago Promedio".

<details>
<summary><b>Ver solución</b></summary>

**Solución:**
```sql
SELECT AVG(amount) AS "Pago Promedio" FROM payments;
```

**Explicación:**
Combinamos `AVG()` con un alias para hacer el resultado más legible. El encabezado mostrará "Pago Promedio" seguido del valor calculado.

</details>

---

## Ejercicio 10: Todas las funciones de agregado juntas

**Enunciado:**
Escribe una consulta que muestre:
- El total de pagos (COUNT)
- La suma de montos (SUM)
- El pago máximo (MAX)
- El pago mínimo (MIN)
- El pago promedio (AVG)

Con alias descriptivos.

<details>
<summary><b>Ver solución</b></summary>

**Solución:**
```sql
SELECT 
  COUNT(*) AS "Total Pagos",
  SUM(amount) AS "Suma Total",
  MAX(amount) AS "Máximo",
  MIN(amount) AS "Mínimo",
  AVG(amount) AS "Promedio"
FROM payments;
```

**Explicación:**
Podemos combinar múltiples funciones de agregado en una sola consulta para obtener un resumen estadístico completo de los datos. Cada función se evalúa sobre toda la tabla y devuelve un único valor.

</details>

---

## Ejercicio 11: COUNT en tabla products

**Enunciado:**
Escribe una consulta que cuente cuántos productos hay en la tabla `products`.

<details>
<summary><b>Ver solución</b></summary>

**Solución:**
```sql
SELECT COUNT(*) AS "Total Productos" FROM products;
```

**Explicación:**
`COUNT(*)` funciona de la misma manera en cualquier tabla. En este caso, contamos el número total de productos en el inventario.

</details>

---

## Ejercicio 12: SUM de cantidad en stock

**Enunciado:**
Escribe una consulta que calcule la cantidad total de productos en stock (suma de `quantityInStock`) en la tabla `products`.

<details>
<summary><b>Ver solución</b></summary>

**Solución:**
```sql
SELECT SUM(quantityInStock) AS "Total en Stock" FROM products;
```

**Explicación:**
Sumamos la columna `quantityInStock` para obtener cuántas unidades de producto tenemos en total en el inventario.

</details>

---

## Ejercicio 13: MAX y MIN de cantidad en stock

**Enunciado:**
Escribe una consulta que muestre:
- La cantidad máxima en stock de cualquier producto
- La cantidad mínima en stock de cualquier producto

Con alias "Máximo en Stock" y "Mínimo en Stock".

<details>
<summary><b>Ver solución</b></summary>

**Solución:**
```sql
SELECT 
  MAX(quantityInStock) AS "Máximo en Stock",
  MIN(quantityInStock) AS "Mínimo en Stock"
FROM products;
```

**Explicación:**
Encontramos cuál es el producto con más inventario y cuál es el que tiene menos. Esto es útil para identificar productos que necesitan reabastecimiento.

</details>

---

## Ejercicio 14: AVG de cantidad en stock

**Enunciado:**
Escribe una consulta que calcule la cantidad promedio de productos en stock.

<details>
<summary><b>Ver solución</b></summary>

**Solución:**
```sql
SELECT AVG(quantityInStock) AS "Promedio en Stock" FROM products;
```

**Explicación:**
Calculamos el promedio de inventario de todos los productos. Esto ayuda a entender el nivel típico de stock en el almacén.

</details>

---

## Ejercicio 15: COUNT con WHERE

**Enunciado:**
Escribe una consulta que cuente cuántos pagos son mayores a 50000 en la tabla `payments`.

<details>
<summary><b>Ver solución</b></summary>

**Solución:**
```sql
SELECT COUNT(*) AS "Pagos Mayores a 50000" FROM payments WHERE amount > 50000;
```

**Explicación:**
Combinamos `COUNT()` con `WHERE` para contar solo los registros que cumplen una condición. En este caso, contamos cuántos pagos son especialmente grandes.

</details>

---

## Ejercicio 16: SUM con WHERE

**Enunciado:**
Escribe una consulta que sume el monto de todos los pagos que sean menores o iguales a 10000.

<details>
<summary><b>Ver solución</b></summary>

**Solución:**
```sql
SELECT SUM(amount) AS "Total Pagos Menores o Iguales a 10000" FROM payments WHERE amount <= 10000;
```

**Explicación:**
Sumamos solamente los valores que cumplen la condición `WHERE`. Esto nos da el total de dinero recibido de pagos pequeños.

</details>

---

## Ejercicio 17: AVG con WHERE

**Enunciado:**
Escribe una consulta que calcule el promedio de cantidad en stock para productos que tengan más de 5000 unidades.

<details>
<summary><b>Ver solución</b></summary>

**Solución:**
```sql
SELECT AVG(quantityInStock) AS "Promedio de Productos con >5000 stock" FROM products WHERE quantityInStock > 5000;
```

**Explicación:**
Filtramos con `WHERE` para incluir solo productos que cumplen la condición, y luego calculamos el promedio solo para esos productos.

</details>

---

## Ejercicio 18: MAX con WHERE

**Enunciado:**
Escribe una consulta que encuentre el pago máximo realizado por clientes cuyo número sea mayor a 300.

<details>
<summary><b>Ver solución</b></summary>

**Solución:**
```sql
SELECT MAX(amount) AS "Pago Máximo de Clientes >300" FROM payments WHERE customerNumber > 300;
```

**Explicación:**
Filtramos los pagos de clientes con número mayor a 300 y luego encontramos el máximo entre esos pagos filtrados.

</details>

---

## Ejercicio 19: Múltiples agregados con WHERE

**Enunciado:**
Escribe una consulta que muestre para la tabla `products`:
- Total de productos con stock mayor a 3000
- Suma del stock de productos con más de 3000 unidades
- Promedio del stock de productos con más de 3000 unidades

<details>
<summary><b>Ver solución</b></summary>

**Solución:**
```sql
SELECT 
  COUNT(*) AS "Total Productos",
  SUM(quantityInStock) AS "Total Stock",
  AVG(quantityInStock) AS "Promedio Stock"
FROM products 
WHERE quantityInStock > 3000;
```

**Explicación:**
Combinamos múltiples funciones de agregado con un filtro `WHERE`. Todas las operaciones se aplican solo a los productos que tienen más de 3000 unidades en stock.

</details>

---

## Ejercicio 20: COUNT de valores no nulos

**Enunciado:**
Escribe una consulta que cuente cuántos valores no nulos hay en la columna `checkNumber` de la tabla `payments`.

<details>
<summary><b>Ver solución</b></summary>

**Solución:**
```sql
SELECT COUNT(checkNumber) AS "Pagos con Número de Cheque" FROM payments;
```

**Explicación:**
`COUNT(columna)` cuenta solo los valores no nulos en esa columna. Si algunos registros de pago no tienen número de cheque (valor nulo), esos no se contarán.

</details>

---

## Ejercicio 21: Comparar COUNT(*) vs COUNT(columna)

**Enunciado:**
Escribe dos consultas para la tabla `payments`:
1. Cuenta el total de registros usando `COUNT(*)`
2. Cuenta solo los registros que tienen un número de cheque usando `COUNT(checkNumber)`

¿Cuál será mayor?

<details>
<summary><b>Ver solución</b></summary>

**Solución 1:**
```sql
SELECT COUNT(*) AS "Total Registros" FROM payments;
```

**Solución 2:**
```sql
SELECT COUNT(checkNumber) AS "Registros con Cheque" FROM payments;
```

**Explicación:**
`COUNT(*)` cuenta todas las filas incluyendo aquellas con valores nulos, mientras que `COUNT(checkNumber)` cuenta solo las filas con valores no nulos en esa columna. 

Si hay diferencia, significa que algunos pagos no tienen número de cheque asociado. `COUNT(*)` siempre será mayor o igual a `COUNT(columna)`.

</details>

---

## Ejercicio 22: MIN y MAX con WHERE

**Enunciado:**
Escribe una consulta que muestre:
- El stock mínimo de productos que tienen menos de 5000 unidades
- El stock máximo de productos que tienen menos de 5000 unidades

<details>
<summary><b>Ver solución</b></summary>

**Solución:**
```sql
SELECT 
  MIN(quantityInStock) AS "Mínimo Stock (<5000)",
  MAX(quantityInStock) AS "Máximo Stock (<5000)"
FROM products 
WHERE quantityInStock < 5000;
```

**Explicación:**
Filtramos productos con menos de 5000 unidades y luego encontramos el mínimo y máximo dentro de ese grupo. Esto ayuda a entender el rango de inventario de productos con stock bajo.

</details>

---

## Ejercicio 23: SUM y AVG comparación

**Enunciado:**
Escribe una consulta que muestre:
- La suma de todos los pagos
- El promedio de todos los pagos
- El total de pagos realizados

<details>
<summary><b>Ver solución</b></summary>

**Solución:**
```sql
SELECT 
  SUM(amount) AS "Suma Total",
  AVG(amount) AS "Promedio",
  COUNT(*) AS "Total Pagos"
FROM payments;
```

**Explicación:**
Combinamos `SUM()`, `AVG()` y `COUNT()` para obtener una visión estadística completa. Si divides "Suma Total" entre "Total Pagos", deberías obtener aproximadamente el "Promedio" (puede haber pequeñas diferencias por redondeo).

</details>

---

## Ejercicio 24: Agregados con filtro complejo

**Enunciado:**
Escribe una consulta que muestre para la tabla `payments`:
- Total de pagos menores a 20000
- Suma de montos para pagos menores a 20000
- Promedio de montos para pagos menores a 20000
- Máximo pago entre los menores a 20000

<details>
<summary><b>Ver solución</b></summary>

**Solución:**
```sql
SELECT 
  COUNT(*) AS "Total Pagos <20000",
  SUM(amount) AS "Suma Pagos <20000",
  AVG(amount) AS "Promedio Pagos <20000",
  MAX(amount) AS "Máximo Pago <20000"
FROM payments 
WHERE amount < 20000;
```

**Explicación:**
Filtramos pagos menores a 20000 y luego aplicamos múltiples funciones de agregado. Este es un análisis típico para entender las características de un subconjunto de datos.

</details>

---

## Consejos para evitar errores comunes

### Error 1: Olvidar el FROM
❌ **Incorrecto:**
```sql
SELECT COUNT(*);
```

✅ **Correcto:**
```sql
SELECT COUNT(*) FROM payments;
```

### Error 2: Función de agregado sin FROM
❌ **Incorrecto:**
```sql
SELECT SUM(amount);
```

✅ **Correcto:**
```sql
SELECT SUM(amount) FROM payments;
```

### Error 3: Usar agregado sin función
❌ **Incorrecto:**
```sql
SELECT amount FROM payments;
```

✅ **Correcto (si quieres la suma):**
```sql
SELECT SUM(amount) FROM payments;
```

### Error 4: Orden incorrecto de WHERE
❌ **Incorrecto:**
```sql
SELECT COUNT(*) FROM payments ORDER BY amount WHERE amount > 5000;
```

✅ **Correcto:**
```sql
SELECT COUNT(*) FROM payments WHERE amount > 5000;
```

### Error 5: Confundir COUNT(*) con COUNT(columna)
❌ **Incorrecto (si quieres todos los registros):**
```sql
SELECT COUNT(amount) FROM payments;
```

✅ **Correcto:**
```sql
SELECT COUNT(*) FROM payments;
```

---

## Resumen de funciones de agregado

| Función | Descripción | Ejemplo |
|---------|-------------|---------|
| **COUNT(*)** | Cuenta todas las filas | `COUNT(*)` |
| **COUNT(columna)** | Cuenta valores no nulos | `COUNT(checkNumber)` |
| **SUM(columna)** | Suma valores numéricos | `SUM(amount)` |
| **AVG(columna)** | Calcula promedio | `AVG(amount)` |
| **MAX(columna)** | Encuentra valor máximo | `MAX(amount)` |
| **MIN(columna)** | Encuentra valor mínimo | `MIN(amount)` |
| **Con WHERE** | Filtra antes de agregar | `WHERE amount > 5000` |
| **Con alias** | Renombra el resultado | `AS "Mi Alias"` |

---

## Características clave de funciones de agregado

- **Devuelven un único valor** - Cada función devuelve una sola fila de resultado, no múltiples filas
- **Operan sobre múltiples filas** - A diferencia de funciones simples, operan sobre todo un conjunto de datos
- **Ignoran nulos (excepto COUNT(*))** - `SUM()`, `AVG()`, `MAX()`, `MIN()` ignoran valores nulos; `COUNT()` sin * también los ignora
- **Se combinan con WHERE** - Puedes filtrar datos antes de aplicar el agregado
- **Se pueden usar múltiples a la vez** - En una sola consulta puedes usar varias funciones de agregado

---

## Diferencia importante: COUNT(*) vs COUNT(columna)

| Aspecto | COUNT(*) | COUNT(columna) |
|--------|----------|----------------|
| **Cuenta** | Todas las filas | Valores no nulos |
| **Uso** | Cuando quieres total de registros | Cuando quieres registros sin nulls |
| **Ejemplo** | `COUNT(*)` cuenta 100 filas | `COUNT(checkNumber)` cuenta 95 si hay 5 nulls |

---

## ¿Necesitas más ayuda?

Si tienes dudas sobre algún ejercicio o necesitas más práctica, recuerda:
- Las funciones de agregado operan sobre TODOS los registros (o los filtrados por WHERE)
- `COUNT(*)` cuenta todas las filas
- `COUNT(columna)` cuenta solo valores no nulos
- `SUM()` suma valores numéricos
- `AVG()` calcula el promedio
- `MAX()` y `MIN()` encuentran máximos y mínimos
- Siempre necesitas `FROM` después de las funciones de agregado
- `WHERE` va antes de usar la función de agregado
